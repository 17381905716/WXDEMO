var mtjwxsdk=function(e){"use strict";var t,n="1.6.2",s={wx:null,boxjs:null},h={},p={aso:{}},g={logServerUrl:"https://hmma.baidu.com/mini.gif",maxRequestRetryCount:5,requestRetryFirstDelay:1e3,requestRetryMultiple:4,maxRequestDataLength:204800,maxUint8:255,maxUint32:4294967295,enabledEvents:{app:["show","hide","error"],page:["show","hide"],share:["action","success","fail"],event:"*"},storageKeys:{appId:"mtj_appid",key:"mtj_key",uuid:"mtj_uuid",shareCount:"mtj_scnt"}},c=function(){return"undefined"!=typeof crypto&&crypto.getRandomValues?crypto.getRandomValues(new Uint32Array(1))[0]:Math.floor(Math.random()*g.maxUint32)},a=function(e,t){return"[object "+t+"]"==={}.toString.call(e)},r=function n(r){return(a(r,"Object")||a(r,"Array"))&&Object.keys(r).forEach(function(e){var t=r[e];a(t,"Object")||a(t,"Array")?r[e]=n(t):r[e]=""+t}),r},o=0,y={sendRequest:function(e){if(e.data=e.data||{},e.data.v=n,e.data.rqc=++o,t=e.data,!(JSON.stringify(t).length<=g.maxRequestDataLength))return o--,void(e.fail&&e.fail(new Error("invalid data")));var t;(s.wx?function t(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:g.requestRetryFirstDelay;return s.wx.request({url:n.url,data:n.data,header:Object.assign({"content-type":"application/json"},n.header),method:n.method||"POST",dataType:n.dataType||"json",success:function(e){delete n.data.rtc,n.success&&n.success(e)},fail:function(e){n.data.rtc=(n.data.rtc||0)+1,n.data.rtc<=g.maxRequestRetryCount?setTimeout(function(){return t(n,r*g.requestRetryMultiple)},r):(delete n.data.rtc,n.fail&&n.fail(e))}})}:function r(a){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:g.requestRetryFirstDelay,i="_mtj_swan_sdk_request_cb_"+c();global[i]=function(e){delete global[i];var t=JSON.parse(e);if(0==+t.status){delete a.data.rtc;var n=JSON.parse(decodeURIComponent(t.data)).data;a.success&&a.success(n)}else a.data.rtc=(a.data.rtc||0)+1,a.data.rtc<=g.maxRequestRetryCount?global.setTimeout(function(){return r(a,o*g.requestRetryMultiple)},o):(delete a.data.rtc,a.fail&&a.fail(t))},s.boxjs.net.request({cancelNumTostr:!0,url:a.url,data:a.data,header:Object.assign({"content-type":"application/json"},a.header),method:a.method||"POST",dataType:a.dataType||"json",cb:i})})(e)},trackEvent:function(e){var t=this;if(!("*"!==g.enabledEvents[e.et]&&g.enabledEvents[e.et].indexOf(e.en)<0)){e.rid=c(),e.aso=e.aso||{};var n={url:g.logServerUrl,dataType:"string",data:Object.assign({},h,e),fail:function(e){return t.trackError("sendRequest",e)}};this.sendRequest(n)}},trackError:function(e,t){var n=a(t,"Object")?JSON.stringify(t):""+t;this.sendRequest({url:g.logServerUrl,dataType:"string",data:Object.assign({},h,{et:"error",en:e,ep:{ex:n},rid:c()})})}},m=function(e){try{return s.wx.getStorageSync(e)}catch(e){y.trackError("getStorageSync",e)}},v=function(e,t){try{s.wx.setStorageSync(e,t)}catch(e){y.trackError("setStorageSync",e)}},i=function(){return Promise.resolve().then(function(){return new Promise(function(e,t){var n=m(g.storageKeys.uuid);if(a(n,"String")&&32===n.length)return e(n);n=([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,function(e){return(e^("undefined"!=typeof crypto&&crypto.getRandomValues?crypto.getRandomValues(new Uint8Array(1))[0]:Math.floor(Math.random()*g.maxUint8))&15>>e/4).toString(16)}),v(g.storageKeys.uuid,n),e(n)})})},u=function(n){return Promise.resolve().then(function(){return new Promise(function(t,e){if(!n)return t();try{s.wx.getShareInfo({shareTicket:n,success:function(e){delete e.errMsg,t(e)},fail:function(e){t({})}})}catch(e){y.trackError("getShareInfo",e),t({})}})})},f=function(){if(t)return t;var e;try{e=require("./mtj-wx-sdk.config")}catch(e){return console.error("请把mtj-wx-sdk.config.js文件拷贝到utils目录中"),new Promise(function(e){return 0})}return e&&e.appKey?(h.key=e.appKey,h.sid=c(),h.rqc=0,t=Promise.all([i(),Promise.resolve().then(function(){return new Promise(function(t,e){try{s.wx.getSetting({success:function(e){e.authSetting&&e.authSetting["scope.userInfo"]?s.wx.checkSession({success:function(e){e&&!1===e.result?t({}):s.wx.getUserInfo({success:function(e){delete e.userInfo.errMsg,t(e.userInfo)},fail:function(){t({})}})},fail:function(){t({})}}):t({})},fail:function(){t({})}})}catch(e){y.trackError("getUserInfo",e),t({})}})}),Promise.resolve().then(function(){return new Promise(function(t,e){try{s.wx.getSystemInfo({success:function(e){delete e.errMsg,t(e)},fail:function(e){t({})}})}catch(e){y.trackError("getSystemInfo",e),t({})}})}),Promise.resolve().then(function(){return new Promise(function(t,e){try{s.wx.getNetworkType({success:function(e){delete e.errMsg,t(e)},fail:function(e){t({})}})}catch(e){y.trackError("getNetworkType",e),t({})}})}),e.getLocation?Promise.resolve().then(function(){return new Promise(function(t,e){try{s.wx.getLocation({type:"wgs84",success:function(e){delete e.errMsg,t(e)},fail:function(e){t({})}})}catch(e){y.trackError("getLocation",e),t({})}})}):Promise.resolve()]).then(function(e){h.uuid=e[0],p.user=r(e[1]),p.system=r(e[2]),p.network=r(e[3]),e[4]&&(p.location=r(e[4])),"devtools"===p.system.platform&&g.latestVersion&&function(e,t){for(var n=e.split("."),r=t.split("."),a=0;a<3;a++){var o=+n[a]||0,i=+r[a]||0;if(i<o)return 1;if(o<i)return-1}return 0}(n,g.latestVersion)<0&&console.warn("百度移动统计微信小程序SDK已更新，为不影响您的正常使用，请到SDK下载中心（https://mtj.baidu.com/web/sdk/index）下载最新版本")})):(console.error("请设置mtj-wx-sdk.config.js文件中的appKey字段"),new Promise(function(e){return 0}))},l={onLaunch:function(){y.trackEvent({et:"app",en:"launch"})},onShow:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return p.aso.scene=""+(t.scene||""),t.referrerInfo&&t.referrerInfo.appId?p.aso.referrerInfo=t.referrerInfo:delete p.aso.referrerInfo,p.aso.path=t.path||"",p.aso.query=Object.keys(t.query||{}).map(function(e){return{key:e,value:t.query[e]}}),f().then(function(){return u(t.shareTicket)}).then(function(e){e?p.aso.shareInfo=e:delete p.aso.shareInfo,y.trackEvent(Object.assign({et:"app",en:"show"},p))})},onHide:function(){y.trackEvent({et:"app",en:"hide"})},onError:function(e){var t=a(e,"Object")?JSON.stringify(r(e)):""+e;y.trackEvent({et:"app",en:"error",ep:{ex:t}})}},d=function(e,t){return f().then(function(){return y.trackEvent({et:"page",en:e,ep:t})})},k={onLoad:function(){d("load")},onShow:function(){var e=getCurrentPages(),t=e[e.length-1];return h.path=t.route,h.query=Object.keys(t.options).map(function(e){return{key:e,value:t.options[e]}}).filter(function(e){return"mtj_qrid"!==e.key&&"mtj_lkid"!==e.key&&"mtj_shuuid"!==e.key}),f().then(function(){y.trackEvent(Object.assign({et:"page",en:"show"},p))})},onReady:function(){d("ready")},onHide:function(){d("hide")},onUnload:function(){d("unload")},onPullDownRefresh:function(){d("pullDownRefresh")},onReachBottom:function(){d("reachBottom")},onPageScroll:function(){d("pageScroll")},onTabItemTap:function(e){d("tabItemTap",e)},onShareAppMessage:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=m(g.storageKeys.shareCount);n=(Number.isInteger(n)?n:0)+1,v(g.storageKeys.shareCount,n);var r={cnt:n,from:e.from,path:t.path||""};t.title&&(r.title=""+t.title),e.target&&(r.target=JSON.stringify(e.target)),y.trackEvent(Object.assign({et:"share",en:"action",ep:r},p));var a=p.aso.query.filter(function(e){return"mtj_shuuid"===e.key}),o=a[0]?a[0].value.split("_"):[];h.uuid!==o[o.length-1]&&o.push(h.uuid);var i,s,c,u,f=o.slice(Math.max(0,o.length-3)).join("_");t.path=(i=t.path||h.path,s="mtj_shuuid",c=f,u=0<(i=i.replace(new RegExp(s+"=[^&]*","g"),"").replace(/(\?|&)&/g,"$1").replace(/(\?|&)$/g,"")).indexOf("?")?"&":"?",i+u+s+"="+encodeURIComponent(c));var l=t.success;t.success=function(e){k.shareSuccess(e),l&&l(e)};var d=t.fail;return t.fail=function(e){k.shareFail(e),d&&d(e)},t},shareSuccess:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=[].concat(e.shareTickets);Promise.all(t.map(function(e){return u(e)})).then(function(e){e&&e[0]||(e=[]),y.trackEvent({et:"share",en:"success",ep:{shareInfo:e}})})},shareFail:function(e){y.trackEvent({et:"share",en:"fail",ep:{ex:JSON.stringify(e)}})}},w=function(e){if(t=e.reportName,a(t,"String")&&/^[a-z][a-z0-9_]{0,31}$/.test(t)){var t,r=e.reportParams||{},n=Object.keys(r).filter(function(e){return a(n=e,"String")&&/^[a-z0-9_]{1,32}$/.test(n)&&(t=r[e],a(t,"String")||a(t,"Number"));var t,n}).map(function(e){return{key:""+e,value:""+r[e],type:a(r[e],"String")?"string":"number"}});return f().then(function(){y.trackEvent(Object.assign({et:"event",en:""+e.reportName,ep:{data:n}},p))})}},S=function(e,t,n){var r=t[e];t[e]=function(e){n.call(this,e),r&&r.call(this,e)}},j=function(){h.type=1,s.wx=wx;var e=App;App=function(t){["onLaunch","onShow","onHide","onError"].forEach(function(e){S(e,t,l[e])}),t.mtj={trackEvent:function(e,t){w({reportName:e,reportParams:t})}},e(t)};var t=Page;Page=function(o){["onLoad","onShow","onHide","onReady"].forEach(function(e){S(e,o,k[e])}),["onShareAppMessage"].forEach(function(e){var t,n,r,a;n=o,r=k[t=e],a=n[t],n[t]=function(e){var t=a&&a.call(this,e);return r.call(this,e,t)}}),t(o)}};return j(),e.init=j,e}({});
